<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BeatNexus â€“ Profile</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <!-- APIè¨­å®šã‚’èª­ã¿è¾¼ã¿ -->
  <script src="/js/api-config.js"></script>
  <style>
    :root {
      --accent: #55dde0;
      --accent-dark: #33b5b8;
      --radius: 8px;
      --shadow: 0 4px 12px rgba(0,0,0,0.3);
      --bg-1: #111111;
      --bg-2: #222222;
      --text-1: #ffffff;
      --text-2: #cccccc;
    }
    body {
      margin: 0;
      background: var(--bg-1);
      color: var(--text-1);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #111111, #222222);
    }
    .card {
      position: relative;
      width: 90vw;
      max-width: 480px;
      padding: 2rem;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      gap: 1.3rem;
      border: 1px solid rgba(255,255,255,0.1);
    }
    #langSelect {
      position: absolute;
      top: .8rem;
      right: .8rem;
      width: auto;
      min-width: 3.5rem;
      padding: .3rem .5rem;
      font-size: .75rem;
      background: rgba(40, 40, 40, 0.85);
      color: #ffffff;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 4px;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    h1 {
      font-family: 'Russo One', sans-serif;
      font-size: 1.8rem;
      margin: 0;
      text-align: center;
      color: var(--accent);
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    label {
      font-weight: 600;
      font-size: .95rem;
      display: block;
      margin-bottom: .3rem;
    }
    input, select {
      width: 100%;
      padding: .75rem 1rem;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(0,0,0,0.2);
      color: var(--text-1);
      font-size: 1rem;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(85, 221, 224, 0.3);
    }
    /* ã‚¤ãƒ³ãƒ•ã‚©ã‚¢ã‚¤ã‚³ãƒ³ã¨ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
    .level-selection {
      display: flex;
      align-items: center;
    }
    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 0.5rem;
      cursor: pointer;
      width: 1.6rem;
      height: 1.6rem;
      background: var(--accent);
      color: #000;
      border-radius: 50%;
      font-size: 1rem;
      position: relative;
    }
    .info-icon .tooltip {
      position: absolute;
      left: calc(100% + 0.5rem);
      top: 50%;
      transform: translateY(-50%) translateX(-0.5rem);
      background: var(--bg-2);
      color: var(--text-1);
      padding: 0.8rem;
      border-radius: var(--radius);
      white-space: pre-wrap;
      font-size: 0.85rem;
      line-height: 1.4;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 100;
      pointer-events: none;
      min-width: 240px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .info-icon .tooltip::before {
      content: '';
      position: absolute;
      left: -0.5rem;
      top: 50%;
      transform: translateY(-50%);
      border: 0.5rem solid transparent;
      border-right-color: var(--bg-2);
    }
    .info-icon:hover .tooltip {
      opacity: 1;
      visibility: visible;
      transform: translateY(-50%) translateX(0);
    }
    button {
      width: 100%;
      padding: .8rem;
      font-weight: 600;
      font-size: 1rem;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform .2s, background-color .2s;
    }
    button:disabled {
      opacity: .5;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      background: var(--accent-dark);
    }
    .notice {
      font-size: .8rem;
      color: var(--text-2);
      text-align: center;
    }
    /* ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¹ã‚¿ã‚¤ãƒ« */
    @media (max-width: 767px) {
      .card {
        padding: 1.5rem;
        width: 95%;
      }
      
      h1 {
        font-size: 1.5rem;
      }
      
      .info-icon .tooltip {
        left: 0;
        top: calc(100% + 0.5rem);
        transform: translateY(-0.5rem);
        width: 90vw;
        max-width: 300px;
      }
      
      .info-icon .tooltip::before {
        left: 1rem;
        top: -0.5rem;
        transform: none;
        border-color: transparent;
        border-bottom-color: var(--bg-2);
      }
      
      .info-icon:hover .tooltip {
        transform: translateY(0);
      }
      
      input, select {
        padding: 0.6rem 0.8rem;
      }
      
      button {
        padding: 0.7rem;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <!-- å°å‹ã®è¨€èªåˆ‡æ›¿ -->
    <select id="langSelect">
      <option value="en">EN</option>
      <option value="ja">æ—¥æœ¬èª</option>
      <option value="es">ES</option>
      <option value="fr">FR</option>
      <option value="zh">ä¸­æ–‡</option>
      <option value="ko">í•œêµ­ì–´</option>
    </select>

    <h1 id="title">Profile Setup</h1>

    <div>
      <label id="nameLbl" for="name">Name</label>
      <input id="name" type="text" placeholder="Your stage name" required>
    </div>

    <div>
      <label id="countryLbl" for="country">Country</label>
      <select id="country" required>
        <option value="">--</option>
        <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
        <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
        <option value="KR">ğŸ‡°ğŸ‡· Korea</option>
        <option value="IN">ğŸ‡®ğŸ‡³ India</option>
        <option value="FR">ğŸ‡«ğŸ‡· France</option>
        <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
        <option value="BR">ğŸ‡§ğŸ‡· Brazil</option>
        <option value="PH">ğŸ‡µğŸ‡­ Philippines</option>
        <option value="TH">ğŸ‡¹ğŸ‡­ Thailand</option>
        <option value="GB">ğŸ‡¬ğŸ‡§ United Kingdom</option>
      </select>
    </div>

    <div>
      <label id="levelLbl" for="level">Beatbox Level</label>
      <div class="level-selection">
        <select id="level" required>
          <option value="">--</option>
          <option value="beginner">ğŸ’§ Beginner</option>
          <option value="middle">ğŸŒ± Middle class</option>
          <option value="advanced">ğŸ”¥ Advanced</option>
          <option value="top">ğŸ† Top Player</option>
        </select>
        <span class="info-icon">â„¹ï¸
          <span class="tooltip" id="levelTable"></span>
        </span>
      </div>
    </div>

    <button id="saveBtn" disabled>Save &amp; Go Lobby</button>
    <p id="msg" class="notice"></p>
  </div>

  <script>
    const i18n = {
      en: {
        title: 'Profile Setup',
        nameLbl: 'Name',
        countryLbl: 'Country',
        levelLbl: 'Beatbox Level',
        note: '* These descriptions are only examples.',
        saveBtn: 'Save & Go Lobby',
        saved: 'Saved! Redirectingâ€¦',
        levelTable: `ğŸ… Beginner ğŸ’§
 â”” only basic three sounds / <1 yr / no battle experience / mostly spectator

ğŸ… Middle-class ğŸŒ±
 â”” basics stable + some special sounds / 1â€“3 yrs / local battles

ğŸ… Advanced ğŸ”¥
 â”” multiple advanced techniques / 3â€“5 yrs / mid-level contest placements

ğŸ… Top Player ğŸ†
 â”” pro-level / 5+ yrs / national & international titles

* These descriptions are only examples.`
      },
      ja: {
        title: 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²',
        nameLbl: 'åå‰',
        countryLbl: 'å›½ç±',
        levelLbl: 'ãƒ“ãƒ¼ãƒˆãƒœãƒƒã‚¯ã‚¹ãƒ¬ãƒ™ãƒ«',
        note: 'â€» ä¸Šè¨˜ã¯ã‚ãã¾ã§ä¾‹ã§ã™ã€‚ç›®å®‰ã¨ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚',
        saveBtn: 'ä¿å­˜ã—ã¦ãƒ­ãƒ“ãƒ¼ã¸',
        saved: 'ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒ­ãƒ“ãƒ¼ã¸ç§»å‹•ã—ã¾ã™â€¦',
        levelTable: `ğŸ… ãƒ“ã‚®ãƒŠãƒ¼ ğŸ’§
 â”” åŸºç¤3éŸ³ãŒã‚„ã£ã¨ / æ­´<1å¹´ / ãƒãƒˆãƒ«æœªçµŒé¨“ / è¦³æˆ¦ãƒ¡ã‚¤ãƒ³

ğŸ… ãƒŸãƒ‰ãƒ«ã‚¯ãƒ©ã‚¹ ï¿½ï¿½
 â”” åŸºç¤å®‰å®šï¼‹ç‰¹æ®ŠéŸ³å°‘ã— / 1â€“3å¹´ / ãƒ­ãƒ¼ã‚«ãƒ«å¤§ä¼šå‚åŠ çµŒé¨“

ğŸ… ã‚¢ãƒ‰ãƒãƒ³ã‚¹ ğŸ”¥
 â”” ä¸Šç´šãƒ†ã‚¯è¤‡æ•° / 3â€“5å¹´ / ä¸­è¦æ¨¡å¤§ä¼šå…¥è³çµŒé¨“

ğŸ… ãƒˆãƒƒãƒ—ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ ğŸ†
 â”” ãƒ—ãƒ­ç´š / 5å¹´ä»¥ä¸Š / å›½å†…å¤–ä¸»è¦å¤§ä¼šã®ä¸Šä½å¸¸é€£

â€» ä¸Šè¨˜ã¯ã‚ãã¾ã§ä¾‹ã§ã™ã€‚ç›®å®‰ã¨ã—ã¦é¸æŠã—ã¦ãã ã•ã„ã€‚`
      },
      es: {
        title: 'ConfiguraciÃ³n de Perfil',
        nameLbl: 'Nombre',
        countryLbl: 'PaÃ­s',
        levelLbl: 'Nivel de Beatbox',
        note: '* Estas descripciones son solo ejemplos.',
        saveBtn: 'Guardar e ir al Lobby',
        saved: 'Â¡Guardado! Redirigiendoâ€¦',
        levelTable: `ğŸ… Principiante ğŸ’§
 â”” solo tres sonidos bÃ¡sicos / <1 aÃ±o / sin experiencia en batallas / principalmente espectador

ğŸ… Clase media ğŸŒ±
 â”” bÃ¡sicos estables + algunos sonidos especiales / 1-3 aÃ±os / batallas locales

ğŸ… Avanzado ğŸ”¥
 â”” mÃºltiples tÃ©cnicas avanzadas / 3-5 aÃ±os / clasificaciones en concursos de nivel medio

ğŸ… Jugador Top ğŸ†
 â”” nivel profesional / 5+ aÃ±os / tÃ­tulos nacionales e internacionales`
      },
      fr: {
        title: 'Configuration du Profil',
        nameLbl: 'Nom',
        countryLbl: 'Pays',
        levelLbl: 'Niveau de Beatbox',
        note: '* Ces descriptions sont uniquement des exemples.',
        saveBtn: 'Enregistrer et aller au Lobby',
        saved: 'EnregistrÃ© ! Redirectionâ€¦',
        levelTable: `ğŸ… DÃ©butant ğŸ’§
 â”” seulement trois sons basiques / <1 an / pas d'expÃ©rience de bataille / principalement spectateur

ğŸ… Classe moyenne ğŸŒ±
 â”” bases stables + quelques sons spÃ©ciaux / 1-3 ans / batailles locales

ğŸ… AvancÃ© ğŸ”¥
 â”” plusieurs techniques avancÃ©es / 3-5 ans / placements dans des concours de niveau intermÃ©diaire

ğŸ… Joueur de haut niveau ğŸ†
 â”” niveau pro / 5+ ans / titres nationaux et internationaux`
      },
      zh: {
        title: 'ä¸ªäººèµ„æ–™è®¾ç½®',
        nameLbl: 'å§“å',
        countryLbl: 'å›½å®¶',
        levelLbl: 'Beatboxæ°´å¹³',
        note: '* è¿™äº›æè¿°ä»…ä¸ºç¤ºä¾‹ã€‚',
        saveBtn: 'ä¿å­˜å¹¶è¿›å…¥å¤§å…',
        saved: 'å·²ä¿å­˜ï¼æ­£åœ¨é‡å®šå‘â€¦',
        levelTable: `ğŸ… åˆå­¦è€… ğŸ’§
 â”” ä»…æŒæ¡ä¸‰ç§åŸºæœ¬éŸ³ / ä¸åˆ°1å¹´ / æ— æ¯”èµ›ç»éªŒ / ä¸»è¦æ˜¯è§‚ä¼—

ğŸ… ä¸­çº§é€‰æ‰‹ ğŸŒ±
 â”” åŸºæœ¬åŠŸç¨³å®š+ä¸€äº›ç‰¹æ®ŠéŸ³ / 1-3å¹´ / å‚åŠ è¿‡åœ°æ–¹æ¯”èµ›

ğŸ… é«˜çº§é€‰æ‰‹ ğŸ”¥
 â”” æŒæ¡å¤šç§é«˜çº§æŠ€å·§ / 3-5å¹´ / ä¸­å‹æ¯”èµ›è·å¥–ç»å†

ğŸ… é¡¶å°–é€‰æ‰‹ ğŸ†
 â”” ä¸“ä¸šçº§åˆ« / 5å¹´ä»¥ä¸Š / å›½å†…å¤–æ¯”èµ›å† å†›`
      },
      ko: {
        title: 'í”„ë¡œí•„ ì„¤ì •',
        nameLbl: 'ì´ë¦„',
        countryLbl: 'êµ­ê°€',
        levelLbl: 'ë¹„íŠ¸ë°•ìŠ¤ ë ˆë²¨',
        note: '* ì´ ì„¤ëª…ë“¤ì€ ë‹¨ì§€ ì˜ˆì‹œì…ë‹ˆë‹¤.',
        saveBtn: 'ì €ì¥í•˜ê³  ë¡œë¹„ë¡œ ê°€ê¸°',
        saved: 'ì €ì¥ë¨! ë¦¬ë””ë ‰ì…˜ ì¤‘â€¦',
        levelTable: `ğŸ… ì´ˆë³´ì ğŸ’§
 â”” ê¸°ë³¸ ì„¸ ê°€ì§€ ì†Œë¦¬ë§Œ / 1ë…„ ë¯¸ë§Œ / ë°°í‹€ ê²½í—˜ ì—†ìŒ / ì£¼ë¡œ ê´€ëŒê°

ğŸ… ì¤‘ê¸‰ì ğŸŒ±
 â”” ê¸°ë³¸ê¸° ì•ˆì • + ì¼ë¶€ íŠ¹ìˆ˜ ì†Œë¦¬ / 1-3ë…„ / ë¡œì»¬ ë°°í‹€ ê²½í—˜

ğŸ… ê³ ê¸‰ì ğŸ”¥
 â”” ì—¬ëŸ¬ ê³ ê¸‰ ê¸°ìˆ  ë³´ìœ  / 3-5ë…„ / ì¤‘ê¸‰ ëŒ€íšŒ ì…ìƒ ê²½ë ¥

ğŸ… ìµœìƒìœ„ í”Œë ˆì´ì–´ ğŸ†
 â”” í”„ë¡œ ìˆ˜ì¤€ / 5ë…„ ì´ìƒ / êµ­ë‚´ì™¸ ëŒ€íšŒ ìƒìœ„ê¶Œ

* ì´ ì„¤ëª…ë“¤ì€ ë‹¨ì§€ ì˜ˆì‹œì…ë‹ˆë‹¤.`
      }
    };

    let lang = localStorage.getItem('locale') || 'en';
    const sel = document.getElementById('langSelect');
    sel.value = lang;

    function applyTexts() {
      const t = i18n[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('nameLbl').textContent = t.nameLbl;
      document.getElementById('countryLbl').textContent = t.countryLbl;
      document.getElementById('levelLbl').textContent = t.levelLbl;
      document.getElementById('levelTable').textContent = t.levelTable;
      document.getElementById('saveBtn').textContent = t.saveBtn;
      document.documentElement.lang = lang;
    }

    sel.addEventListener('change', e => {
      lang = e.target.value;
      localStorage.setItem('locale', lang);
      applyTexts();
    });
    applyTexts();

    // å…¥åŠ›æ¤œè¨¼
    const nameI = document.getElementById('name'),
          countryI = document.getElementById('country'),
          levelI = document.getElementById('level'),
          saveBtn = document.getElementById('saveBtn'),
          msg = document.getElementById('msg');

    function validate() {
      saveBtn.disabled = !(nameI.value.trim() && countryI.value && levelI.value);
    }
    [nameI, countryI, levelI].forEach(el => el.addEventListener('input', validate));

    // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®å–å¾—ã¨ä¿å­˜
    async function loadProfile() {
      try {
        // æ—¢å­˜ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãŒã‚ã‚‹ã‹ç¢ºèª
        const r = await callApi('/api/user');
        if (r.ok) {
          const data = await r.json();
          document.getElementById('name').value = data.name;
          document.getElementById('country').value = data.country;
          document.getElementById('level').value = data.level;
        }
      } catch (err) {
        console.error('Profile load error:', err);
      }
    }
    
    async function saveProfile() {
      try {
        const name = document.getElementById('name').value.trim();
        const country = document.getElementById('country').value;
        const level = document.getElementById('level').value;
        
        if (!name) return alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        if (!country) return alert('å›½ã‚’é¸æŠã—ã¦ãã ã•ã„');
        if (!level) return alert('ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„');
        
        const res = await callApi('/api/user', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, country, level })
        });
        
        if (res.ok) {
          window.location.href = '/lobby.html';
        } else {
          alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      } catch (err) {
        console.error('Save error:', err);
        alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    // æ—¢ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¹ã‚­ãƒƒãƒ—
    (async () => {
      const r = await fetch('/api/user');
      if (r.ok) location.href = '/lobby.html';
    })();

    // ä¿å­˜å‡¦ç†
    saveBtn.addEventListener('click', async () => {
      saveBtn.disabled = true;
      const body = {
        name: nameI.value.trim(),
        country: countryI.value,
        level: levelI.value
      };
      const res = await fetch('/api/user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      if (res.ok) {
        msg.textContent = i18n[lang].saved;
        setTimeout(() => location.href = '/lobby.html', 800);
      } else {
        const j = await res.json();
        msg.textContent = 'Error: ' + (j.error || res.status);
        saveBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
